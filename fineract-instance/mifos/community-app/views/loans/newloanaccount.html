<div class="content-container" ng-controller="NewLoanAccAppController">

    <ul class="breadcrumb">
        <li ng-show="groupName"><a href="#/viewgroup/{{groupId}}"><strong>'{{groupName}}'</strong></a></li>
        <li ng-show="clientName"><a href="#/viewclient/{{clientId}}"><strong>'{{clientName}}'</strong></a></li>
        <li class="active">{{'label.anchor.loanapplication' | translate}}</li>
    </ul>
    <wizard current-step="step">
        <div class="card">
            <wz-step icon="fa fa-circle-o" title="{{'label.anchor.loanapplication' | translate}}">
                <div class="card-content">
                    <api-validate></api-validate>
                    <form class="well form-inline" name="newloanaccountform" novalidate="" rc-submit="submit()">
                    <table class="table width100">
                        <tr>
                            <td class="width14">
                                <label>{{ 'label.input.product' | translate }}<span class="required">*</span>:&nbsp;</label>
                                <i class="fa fa-question-sign" tooltip="{{'label.tooltip.product' | translate}}"></i>
                            </td>
                            <td class="width36 paddedbottom10">
                                <select class="form-control width170px" id="productId" ng-change="loanProductChange(formData.productId)"
                                        ng-model="formData.productId" ng-options="product.id as product.name for product in products"
                                        required="required" value="{{product.id}}">
                                    <option style="display:none" value="">{{'label.selectloanproduct' | translate}}</option>
                                </select>
                            </td>
                            <td class="width14">
                                <label ng-show="formData.productId">{{ 'label.input.loanofficer' | translate }}:&nbsp;</label>
                                <i class="fa fa-question-sign" ng-show="formData.productId" tooltip="{{'label.tooltip.loanofficer' | translate}}"></i>
                            </td>
                            <td class="width36 paddedbottom10">
                                <select class="form-control width170px" id="loanOfficerId" ng-model="formData.loanOfficerId"
                                        ng-options="loanOfficer.id as loanOfficer.displayName for loanOfficer in loanaccountinfo.loanOfficerOptions | orderBy:'displayName':reverse"
                                        ng-show="formData.productId" value="{{loanOfficer.id}}">
                                    <option value="">{{'label.selectloanofficer' | translate}}</option>
                                </select>
                            </td>
                        </tr>
                        <tr ng-show="formData.productId">
                            <td><label>{{ 'label.input.loanpurpose' | translate }}:&nbsp;</label>
                            <i class="fa fa-question-sign" tooltip="{{'label.tooltip.loanpurpose' | translate}}"></i></td>
                            <td class="paddedbottom10">
                                <select chosen="loanaccountinfo.loanPurposeOptions" class="form-control width170px" id="loanPurposeId"
                                        ng-model="formData.loanPurposeId"
                                        ng-options="loanPurpose.id as loanPurpose.name for loanPurpose in loanaccountinfo.loanPurposeOptions | orderBy:'name':reverse" value="{{loanPurpose.id}}">
                                    <option value="">{{'label.selectpurpose' | translate}}</option>
                                </select>
                            </td>
                            <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.fundId == true"><label>{{ 'label.input.fund' | translate }}:&nbsp;</label></td>
                            <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.fundId == true">
                                <select class="form-control width170px" id="fundId" ng-model="formData.fundId"
                                        ng-options="fund.id as fund.name for fund in loanaccountinfo.fundOptions" value="{{fund.id}}">
                                    <option value="">{{'label.selectfund' | translate}}</option>
                                </select>
                            </td>
                        </tr>
                        <tr ng-show="formData.productId">
                            <td><label>{{ 'label.input.submittedon' | translate }}<span class="required">*</span>:&nbsp;</label>
                            <i class="fa fa-question-sign" tooltip="{{'label.tooltip.submittedon' | translate}}"></i></td>
                            <td class="paddedbottom10">
                                <input class="form-control" datepicker-pop="dd MMMM yyyy" id="submittedOnDate" is-open="opened"
                                    max="restrictDate" min="'2000-01-01'" name="submittedon" ng-model="date.first" type="text"/>
                            </td>
                            <td>
                                <label title="{{ 'label.input.expecteddisbursementon' | translate }}">{{ 'label.input.disbursementon' | translate }}<span class="required">*</span>:&nbsp;</label>
                                <i class="fa fa-question-sign" tooltip="{{'label.tooltip.disbursementon' | translate}}"></i>
                            </td>
                            <td class="paddedbottom10">
                                <input class="form-control" datepicker-pop="dd MMMM yyyy" id="expectedDisbursementDate" is-open="opened1"
                                    max="'2020-06-22'" min="minDate" name="expecteddisbursementon" ng-model="date.second"
                                    sort type="text"/>
                            </td>
                        </tr>
                        <tr ng-show="formData.productId">
                            <td><label>{{ 'label.input.externalid' | translate }}</label>
                            <i class="fa fa-question-sign" tooltip="{{'label.tooltip.externalid' | translate}}"></i></td>
                            <td class="paddedbottom10">
                                <input class="form-control" id="externalId" name="externalId" ng-model="formData.externalId" type="text"/>
                            </td>
                            <td></td>
                            <td></td>
                        </tr>
                    </table>
                    <div ng-hide="previewRepayment">
                        <div ng-show="loanaccountinfo">
                            <div ng-hide="loanaccountinfo.calendarOptions == undefined">
                            <hr ng-show="loanaccountinfo"/>
                            </div>
                            <label ng-show="loanaccountinfo.calendarOptions"><i class="fa fa-calendar "></i>&nbsp;<strong>{{
                                'label.heading.meetingdetails' | translate }}</strong></label>
                            <table class="table width100" ng-show="loanaccountinfo.calendarOptions">
                                <tr ng-repeat="calendar in loanaccountinfo.calendarOptions">
                                    <td class="width14"><label>{{ 'label.heading.startdate' | translate }}:</label></td>
                                    <td class="width36">{{calendar.startDate | DateFormat}}</td>
                                    <td class="width14"><label>{{ 'label.heading.repeatson' | translate }}:</label></td>
                                    <td class="width36">{{calendar.humanReadable}}</td>
                                </tr>
                                <tr ng-repeat="calendar in loanaccountinfo.calendarOptions">
                                    <td align="center"><input ng-change="syncRepaymentsWithMeetingchange()" ng-model="formData.syncRepaymentsWithMeeting"
                                                            type="checkbox"></td>
                                    <td><label>{{ 'label.input.syncrepaymentswithmeeting' | translate }}</label></td>
                                    <td align="center"><input ng-change="syncDisbursementWithMeetingchange()" ng-model="formData.syncDisbursementWithMeeting"
                                                            type="checkbox"></td>
                                    <td><label>{{ 'label.input.syncdisbursementdatewithmeeting' | translate }}</label></td>
                                </tr>
                            </table>
                            <div ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.linkAccountId == true">
                                <hr ng-show="loanaccountinfo"/>
                            </div>
                            <div ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.linkAccountId == true && response.uiDisplayConfigurations.loanAccount.isHiddenField.createStandingInstruction == true">
                            <label ng-show="loanaccountinfo"><strong>{{ 'label.heading.savingsLinkage' | translate }}</strong></label>
                            </div>
                            <table class="table width100" ng-show="previewRepayment" ng-show="loanaccountinfo">
                                <tr>
                                    <td class="width19" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.linkAccountId == true">
                                        <label>{{ 'label.input.linksavings' | translate }}:</label>
                                    </td>
                                    <td class="width31 paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.linkAccountId == true">
                                        <select class="form-control width170px" id="linkAccountId"
                                                ng-model="formData.linkAccountId" ng-options="savingaccount.id as savingaccount.productName for savingaccount in loanaccountinfo.accountLinkingOptions"
                                                value="{{savingaccount.id}}">
                                            <option value="">{{'label.menu.selectone' | translate}}</option>
                                        </select>
                                    </td>
                                    <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.createStandingInstruction == true">
                                        <label>{{ 'label.input.createStandingInstruction' | translate }}:</label>
                                    </td>
                                    <td class="width31" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.createStandingInstruction == true">
                                            <input class="input-mini-small" id="createStandingInstruction" ng-model="formData.createStandingInstructionAtDisbursement"
                                                    type="checkbox">
                                    </td>
                                </tr>
                            </table>

                                                                <hr ng-show="loanaccountinfo"/>
                                                                <label ng-show="loanaccountinfo"><strong>{{ 'label.heading.terms' | translate }}</strong></label>
                                                                <!--<hr class="terms">-->
                            <table class="table width100" ng-hide="previewRepayment" ng-show="loanaccountinfo">
                                <tr>
                                    <td class="width19"><label>{{ 'label.input.principal' | translate }}&nbsp;<span
                                            class="required">*</span>:</label></td>
                                    <td class="width31 paddedbottom10">
                                        <input class="form-control"  id="principal" late-Validate name="principal" ng-model="formData.principal"
                                            number-format required type="text"/>&nbsp;{{loanaccountinfo.currency.displaySymbol}}
                                        <form-validate valattribute="principal" valattributeform="newloanaccountform"/>
                                    </td>
                                    <td class="width14"><label>{{ 'label.input.loanterm' | translate }}&nbsp;<span class="required">*</span>:</label>
                                    </td>
                                    <td class="width36 paddedbottom10">
                                        <input class="form-control" id="loanTermFrequency" late-Validate name="loanterm"
                                            ng-model="formData.loanTermFrequency" required type="text"/>
                                        <select class="form-control" id="loanTermFrequencyType" ng-disabled="response.uiDisplayConfigurations.loanAccount.isReadOnlyField.loanTermFrequencyType == true" ng-model="formData.loanTermFrequencyType"
                                                ng-options="termFrequencyType.id as termFrequencyType.value for termFrequencyType in loanaccountinfo.termFrequencyTypeOptions"
                                                value="{{termFrequencyType.id}}"/>
                                        <form-validate valattribute="loanterm" valattributeform="newloanaccountform"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.numberOfRepayments == true"><label>{{ 'label.input.numofrepayments' | translate }}&nbsp;<span class="required">*</span></label>
                                    </td>
                                    <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.numberOfRepayments == true">
                                        <input class="form-control" id="numberOfRepayments" late-Validate name="numofrepayments"
                                            ng-model="formData.numberOfRepayments" required type="text"/>&nbsp;
                                        <form-validate valattribute="numofrepayments" valattributeform="newloanaccountform"/>
                                    </td>
                                    <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.repaymentEvery == true"><label>{{ 'label.input.repaidevery' | translate }}&nbsp;<span class="required">*</span></label></td>
                                    <td class="paddedbottom10 width500px" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.repaymentEvery == true">

                                        <input class="form-control" id="repaymentEvery" late-Validate name="repaidevery"
                                            ng-disabled="!loanaccountinfo.product.allowAttributeOverrides.repaymentEvery" ng-model="formData.repaymentEvery" required type="text"/>
                                        <select class="form-control" id="repaymentFrequencyType" ng-disabled="!loanaccountinfo.product.allowAttributeOverrides.repaymentEvery"
                                                ng-model="formData.repaymentFrequencyType"
                                                ng-options="repaymentFrequencyType.id as repaymentFrequencyType.value for repaymentFrequencyType in loanaccountinfo.termFrequencyTypeOptions"
                                                value="{{repaymentFrequencyType.id}}"/>&nbsp;<span ng-show="formData.repaymentFrequencyType == 2">on</span>
                                        <select class="form-control" id="repaymentFrequencyNthDayType" ng-model="formData.repaymentFrequencyNthDayType"
                                                ng-options="repaymentFrequencyNthDayType.id as repaymentFrequencyNthDayType.value for repaymentFrequencyNthDayType in loanaccountinfo.repaymentFrequencyNthDayTypeOptions"
                                                ng-show="formData.repaymentFrequencyType == 2"
                                                value="{{repaymentFrequencyNthDayType.id}}">
                                                <option value="">{{'label.selecton' | translate}}</option>
                                        </select>&nbsp;
                                        <select class="form-control" id="repaymentFrequencyDayOfWeekType" ng-model="formData.repaymentFrequencyDayOfWeekType"
                                                ng-options="repaymentFrequencyDayOfWeekType.id as repaymentFrequencyDayOfWeekType.value for repaymentFrequencyDayOfWeekType in loanaccountinfo.repaymentFrequencyDaysOfWeekTypeOptions"
                                                ng-show="formData.repaymentFrequencyType == 2"
                                                value="{{repaymentFrequencyDayOfWeekType.id}}">
                                                <option value="">{{'label.selectday' | translate}}</option>
                                        </select>&nbsp;

                                        <form-validate valattribute="repaidevery" valattributeform="newloanaccountform"/>
                                    </td>

                                </tr>
                                <tr>
                                    <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.repaymentsStartingFromDate == true">
                                        <label>{{ 'label.input.firstrepaymenton' | translate }}</label>
                                        <i class="fa fa-question-sign" tooltip="{{'label.tooltip.firstrepaymenton' | translate}}"></i>
                                    </td>
                                    <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.repaymentsStartingFromDate == true">
                                        <input class="form-control" datepicker-pop="dd MMMM yyyy" id="repaymentsStartingFromDate"
                                            is-open="opened3" max="'2020-06-22'" min="minDate" ng-model="date.fourth" type="text"/>
                                    </td>
                                    <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.interestChargedFromDate == true"><label class="control-label">{{ 'label.input.interestchargedfrom' | translate }}:</label>
                                    <i class="fa fa-question-sign" tooltip="{{'label.tooltip.interestchargedfrom' | translate}}"></i></td>
                                    <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.interestChargedFromDate == true">
                                        <input class="form-control" datepicker-pop="dd MMMM yyyy" id="interestChargedFromDate" is-open="opened2"
                                            max="'2020-06-22'" min="minDate" ng-model="date.third" type="text"/>
                                    </td>
                                </tr>
                                <tr ng-show="!loanaccountinfo.isLoanProductLinkedToFloatingRate">
                                    <td><label>{{ 'label.input.nominalinterestrate' | translate }}&nbsp;<span
                                        class="required">*</span></label></td>
                                    <td class="paddedbottom10">
                                        <input class="form-control" id="interestRatePerPeriod" name="nominalinterestrate" ng-model="formData.interestRatePerPeriod"
                                        type="text"/>&nbsp;&nbsp;{{loanaccountinfo.interestRateFrequencyType.value}}
                                     </td>
                                     <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.interestType == true"><label>{{ 'label.input.interestmethod' | translate }}</label></td>
                                        <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.interestType == true">
                                            <select class="form-control width170px" id="interestType"
                                              ng-disabled="!loanaccountinfo.product.allowAttributeOverrides.interestType"
                                              ng-model="formData.interestType" ng-options="interestType.id as interestType.value for interestType in loanaccountinfo.interestTypeOptions"
                                              value="{{interestType.id}}"/>
                                      </td>
                                </tr>

                                                                    <tr>
                                                                        <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.amortizationType == true"><label>{{ 'label.input.amortization' | translate }}&nbsp;<span class="required">*</span>:</label>
                                                                        </td>
                                                                        <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.amortizationType == true">
                                                                            <select class="form-control width170px" id="amortizationType" ng-disabled="!loanaccountinfo.product.allowAttributeOverrides.amortizationType"
                                                                                    ng-model="formData.amortizationType"
                                                                                    ng-options="amortizationType.id as amortizationType.value for amortizationType in loanaccountinfo.amortizationTypeOptions" value="{{amortizationType.id}}"/>
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.interestCalculationPeriodType == true"><label>{{ 'label.input.interestcalculationperiod' | translate }}&nbsp;<span
                                                                                class="required">*</span></label></td>
                                                                        <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.interestCalculationPeriodType == true">
                                                                            <select class="form-control width170px" id="interestCalculationPeriodType"
                                                                                    ng-disabled="!loanaccountinfo.product.allowAttributeOverrides.interestCalculationPeriodType" ng-model="formData.interestCalculationPeriodType"
                                                                                    ng-options="interestCalculationPeriodType.id as interestCalculationPeriodType.value for interestCalculationPeriodType in loanaccountinfo.interestCalculationPeriodTypeOptions" value="{{interestCalculationPeriodType.id}}"/>
                                                                        </td>
                                                                        <td colspan="2" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.interestCalculationPeriodType == true || formData.interestCalculationPeriodType == 0"><label>{{ 'label.input.allowpartialperiodinterestcalcualtion' | translate }}&nbsp;<span class="required">*</span>: &nbsp;</label>
                                                                            <label class="checkbox control-label">
                                                                                <input id="allowPartialPeriodInterestCalcualtion" ng-disabled="!loanaccountinfo.product.allowAttributeOverrides.interestCalculationPeriodType"
                                                                                    ng-model="formData.allowPartialPeriodInterestCalcualtion" type="checkbox">
                                                                            </label>
                                                                        </td>

                                                                    </tr>
                                                                    <tr>
                                                                        <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.inArrearsTolerance == true"><label>{{ 'label.input.arearstolerance' | translate }}</label></td>
                                                                        <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.inArrearsTolerance == true">
                                                                            <input class="form-control" id="inArrearsTolerance"
                                                                                ng-disabled="!loanaccountinfo.product.allowAttributeOverrides.inArrearsTolerance"
                                                                                ng-model="formData.inArrearsTolerance" number-format type="text"/>&nbsp;{{loanaccountinfo.currency.displaySymbol}}
                                                                        </td>
                                                                        <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.graceOnInterestCharged == true"><label>{{ 'label.input.interestfreeperiod' | translate }}</label></td>
                                                                        <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.graceOnInterestCharged == true">
                                                                            <input class="form-control" id="graceOnInterestCharged" ng-model="formData.graceOnInterestCharged" type="text"/>
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.transactionProcessingStrategyId == true"><label>{{ 'label.input.repaymentstrategy' | translate }}&nbsp;<span
                                                                                class="required">*</span></label></td>
                                                                        <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.transactionProcessingStrategyId == true">
                                                                            <select class="form-control width170px" id="transactionProcessingStrategyId"
                                                                                    ng-disabled="!loanaccountinfo.product.allowAttributeOverrides.transactionProcessingStrategyId"
                                                                                    ng-model="formData.transactionProcessingStrategyId"
                                                                                    ng-options="transactionProcessingStrategy.id as transactionProcessingStrategy.name for transactionProcessingStrategy in loanaccountinfo.transactionProcessingStrategyOptions" value="{{transactionProcessingStrategy.id}}"/>
                                                                        </td>
                                                                        <td colspan=2>
                                                                            <lable>{{'label.input.grace' | translate }}:</lable>
                                                                            <i class="icon-question-sign" tooltip="{{'label.tooltip.moratorium' | translate}}"></i>
                                                                            <label>{{'label.input.onprincipalpayment' | translate}}</label>
                                                                            <input class="input-mini-small" id="graceOnPrincipalPayment" ng-disabled="!loanaccountinfo.product.allowAttributeOverrides.graceOnPrincipalAndInterestPayment"
                                                                                ng-model="formData.graceOnPrincipalPayment"
                                                                                type="text">
                                                                            <label ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.graceOnInterestPayment == true">{{'label.input.oninterestpayment' | translate}}</label>
                                                                            <input class="input-mini-small" id="graceOnInterestPayment" ng-disabled="!loanaccountinfo.product.allowAttributeOverrides.graceOnPrincipalAndInterestPayment" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.graceOnInterestPayment == true"
                                                                                ng-model="formData.graceOnInterestPayment"
                                                                                type="text">
                                                                            <label ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.graceOnArrearsAgeing == true">{{'label.input.onduedate' | translate}}</label>
                                                                            <input class="input-mini-small" id="graceOnArrearsAgeing" ng-disabled="!loanaccountinfo.product.allowAttributeOverrides.graceOnArrearsAgeing" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.graceOnArrearsAgeing == true"
                                                                                ng-model="formData.graceOnArrearsAgeing" type="text">
                                                                        </td>
                                                                    </tr>
                                                                    <tr data-ng-show="loanaccountinfo.canDefineInstallmentAmount">
                                                                        <td colspan=2>
                                                                            <label>{{ 'label.input.fixedemiamount' | translate }}:</label>&nbsp;
                                                                            <input class="form-control" id="fixedEmiAmount" ng-model="formData.fixedEmiAmount" number-format type="text"/>&nbsp;

                                                                        </td>
                                                                    </tr>
                                                                    <tr ng-show="loanaccountinfo.canUseForTopup">
                                                                        <td><label>{{ 'label.heading.isTopup' | translate }}</label></td>
                                                                        <td class="paddedbottom10">
                                                                            <input name="isTopup" ng-model="formData.isTopup" type="checkbox"/>
                                                                        </td>
                                                                        <td ng-show="formData.isTopup == true"><label>{{ 'label.input.loanIdToClose' | translate }}</label></td>
                                                                        <td class="width36 paddedbottom10" ng-show="formData.isTopup == true">
                                                                            <select class="form-control width170px" id="loanIdToClose"
                                                                                    ng-model="formData.loanIdToClose" ng-options="loanSummary.id as loanSummary.accountNo for loanSummary in loanaccountinfo.clientActiveLoanOptions"
                                                                                    value="{{loanSummary.id}}"/>
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td colspan="4" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true"><hr></td>
                                                                    </tr>
                                                                    <tr ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                        <td>
                                                                            <label class="control-label">{{ 'label.input.recalculateinterest' | translate }}</label>
                                                                        </td>
                                                                        <td class="paddedbottom10">
                                                                            <label class="control-label">{{ loanaccountinfo.isInterestRecalculationEnabled | YesOrNo }}</label>
                                                                        </td>
                                                                        <td data-ng-show="loanaccountinfo.isInterestRecalculationEnabled">
                                                                            <label>{{ 'label.input.daysinyears' | translate }}</label>
                                                                            <i class="icon-question-sign" tooltip="{{'label.tooltip.days' | translate}}"></i>
                                                                        </td>
                                                                        <td class="paddedbottom10">
                                                                            <label>{{ loanaccountinfo.daysInYearType.value}}</label>
                                                                        </td>
                                                                    </tr>
                                                                    <tr data-ng-show="loanaccountinfo.isInterestRecalculationEnabled">
                                                                        <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label>{{ 'label.input.interest.recalculation.reschdule.strategy' | translate }}</label>
                                                                        </td>
                                                                        <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label>{{ loanaccountinfo.interestRecalculationData.rescheduleStrategyType.value}}</label>
                                                                        </td>
                                                                        <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label>{{ 'label.input.daysinmonth' | translate }}</label>
                                                                            <i class="icon-question-sign" tooltip="{{'label.tooltip.days' | translate}}"></i>
                                                                        </td>
                                                                        <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label>{{ loanaccountinfo.daysInMonthType.value }}</label>
                                                                        </td>
                                                                    </tr>
                                                                    <tr data-ng-show="loanaccountinfo.isInterestRecalculationEnabled">
                                                                        <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label class="control-label">{{ 'label.input.interest.recalculation.compounding.method' | translate }}</label>
                                                                        </td>
                                                                        <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label>{{ loanaccountinfo.interestRecalculationData.interestRecalculationCompoundingType.value}}</label>
                                                                        </td>

                                                                        <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label class="control-label">{{ 'label.input.frequency.for.recalculte.outstanding.principal' |
                                                                                translate }}<span class="required">*</span></label>
                                                                        </td>
                                                                        <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label>{{ loanaccountinfo.interestRecalculationData.recalculationRestFrequencyType.value}}</label>
                                                                            <label data-ng-show="loanaccountinfo.interestRecalculationData.recalculationRestFrequencyType.id == 3 &&
                                            loanaccountinfo.interestRecalculationData.recalculationRestFrequencyWeekday != null"> on {{ loanaccountinfo.interestRecalculationData.recalculationRestFrequencyWeekday.value}}</label>
                                                                            <label data-ng-show="loanaccountinfo.interestRecalculationData.recalculationRestFrequencyType.id == 4 &&
                                            loanaccountinfo.interestRecalculationData.recalculationRestFrequencyOnDay != null">on day {{ loanaccountinfo.interestRecalculationData.recalculationRestFrequencyOnDay}}</label>
                                                                            <label data-ng-show="loanaccountinfo.interestRecalculationData.recalculationRestFrequencyType.id == 4 &&
                                            loanaccountinfo.interestRecalculationData.recalculationRestFrequencyOnDay == null &&
                                            loanaccountinfo.interestRecalculationData.recalculationRestFrequencyNthDay != null">on {{ loanaccountinfo.interestRecalculationData.recalculationRestFrequencyNthDay.value}} {{ loanaccountinfo.interestRecalculationData.recalculationRestFrequencyWeekday.value}}
                                                                            </label>
                                                                        </td>
                                                                    </tr>
                                                                    <tr data-ng-show="loanaccountinfo.isInterestRecalculationEnabled && loanaccountinfo.interestRecalculationData.recalculationRestFrequencyType.id != 1">
                                                                        <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label class="control-label">{{ 'label.input.frequenc.interval.for.recalculte.outstanding.principal' | translate }}</label>
                                                                        </td>
                                                                        <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label>{{ loanaccountinfo.interestRecalculationData.recalculationRestFrequencyInterval}}</label>
                                                                        </td>
                                                                    </tr>
                                                                    <tr data-ng-show="loanaccountinfo.isInterestRecalculationEnabled  && loanaccountinfo.interestRecalculationData.interestRecalculationCompoundingType.id != 0">
                                                                        <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label class="control-label">{{ 'label.input.frequency.for.compounding' |
                                                                                translate }}<span class="required">*</span></label>
                                                                        </td>
                                                                        <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label>{{ loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyType.value}}</label>
                                                                            <label data-ng-show="loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyType.id == 3 &&
                                            loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyWeekday != null"> on {{ loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyWeekday.value}}</label>
                                                                            <label data-ng-show="loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyType.id == 4 &&
                                            loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyOnDay != null">on day {{ loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyOnDay}}</label>
                                                                            <label data-ng-show="loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyType.id == 4 &&
                                            loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyOnDay == null &&
                                            loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyNthDay != null">on {{ loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyNthDay.value}} {{ loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyWeekday.value}}
                                                                            </label>
                                                                        </td>
                                                                    </tr>
                                                                    <tr data-ng-show="loanaccountinfo.isInterestRecalculationEnabled && loanaccountinfo.interestRecalculationData.interestRecalculationCompoundingType.id != 0 && loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyType.id != 1">
                                                                        <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label class="control-label">{{ 'label.input.frequenc.interval.for.compounding' | translate }}</label>
                                                                        </td>
                                                                        <td class="paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.interestRecalculationSection == true">
                                                                            <label>{{ loanaccountinfo.interestRecalculationData.recalculationCompoundingFrequencyInterval}}</label>
                                                                        </td>
                                                                    </tr>

                                                                </table>


                            <div ng-hide="previewRepayment" ng-show="loanaccountinfo">
                                <div ng-show="multiDisburseLoan">
                                    <hr/>
                                    <label><strong>{{ 'label.heading.tranchedetails' | translate }}</strong></label>
                                    <table class="table width100">
                                        <tr>
                                            <td class="width14"><label>{{'label.input.outstandingloanbalance' | translate}}:</label></td>
                                            <td class="width36 paddedbottom10">
                                                <input class="form-control" id="maxOutstandingLoanBalance"
                                                    ng-model="formData.maxOutstandingLoanBalance" number-format type="text"/>&nbsp;
                                                <a ng-click="addTranches()" title="{{ 'label.button.addtranch' | translate }}"><i
                                                        class="fa fa-plus "></i></a>
                                            </td>
                                        </tr>
                                    </table>
                                    <table class="table width100" ng-show="formData.disbursementData.length>0">
                                        <thead>
                                        <tr class="graybg">
                                            <th>{{'label.input.expecteddisbursementon' | translate}}</th>
                                            <th>{{'label.input.principal' | translate}}</th>
                                            <th>&nbsp;</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="disbursementDetail in formData.disbursementData">
                                            <td>
                                                <input class="form-control" datepicker-pop="dd MMMM yyyy"
                                                    id="disbursementDetail[{{$index}}].expectedDisbursementDate"
                                                    is-open="'openedtranche'+$index"
                                                    max="'2020-06-22'"
                                                    min="minDate" ng-model="disbursementDetail.expectedDisbursementDate" placeholder="{{'label.input.expecteddisbursementon' | translate}}" type="text"/>
                                            </td>
                                            <td>
                                                <input class="input-sm form-control" id="{{disbursementDetail[$index].principal}}" ng-model="disbursementDetail.principal" number-format
                                                    placeholder="{{'label.input.principal' | translate}}"
                                                    type="text">
                                            </td>
                                            <td><a ng-click="deleteTranches($index)"><i class="fa fa-times "></i></a></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <hr/>
                                <div class="col-md-12">
                                    <label><strong>{{ 'label.heading.charges' | translate }}</strong></label>
                                    <select class="form-control width170px"
                                            ng-model="chargeFormData.chargeId"
                                            ng-options="charge.id as (charge.name + ',' + charge.currency.displaySymbol) for charge in loanaccountinfo.chargeOptions|filter:loanaccountinfo.currency.code:strict" value="{{charge.id}}">
                                        <option value="">{{'label.selectcharge' | translate}}</option>
                                    </select>
                                    <a ng-click="addCharge()"><i class="fa fa-plus "></i></a>
                                </div>
                                <table class="table width100" ng-show="charges.length>0">
                                    <tr class="graybg">
                                        <th>{{'label.heading.name' | translate}}</th>
                                        <th>{{'label.heading.type' | translate}}</th>
                                        <th>{{'label.heading.amount' | translate}}</th>
                                        <th>{{'label.heading.collectedon' | translate}}</th>
                                        <th>{{'label.heading.date' | translate}}</th>
                                        <th>{{'label.heading.actions' | translate}}</th>
                                    </tr>
                                    <tr ng-repeat="charge in charges">
                                        <td>{{charge.name}},{{charge.currency.displaySymbol}}</td>
                                        <td>{{charge.chargeCalculationType.value}}</td>
                                        <td><input class="form-control" id="{{charges[$index].amount}}" ng-model="charge.amount" number-format
                                                placeholder="{{'label.input.amount' | translate}}" type="text"></td>
                                        <td>{{charge.chargeTimeType.value}}</td>
                                        <td>
                                            <input class="form-control" datepicker-pop="dd MMMM yyyy" id="charges[{{$index}}].duedate" is-open="'openedch'+$index"
                                                max="'2020-06-22'" min="minDate"
                                                ng-model="charge.dueDate" placeholder="{{'label.input.duedate' | translate}}" type="text"/>
                                        </td>
                                        <td><a ng-click="deleteCharge($index)"><i class="fa fa-times "></i></a></td>
                                    </tr>
                                </table>
                                <div ng-show="loanaccountinfo.overdueCharges.length>0">
                                    <label><strong>{{ 'label.heading.overduepenalitycharge' | translate }}</strong></label>
                                    <table class="table" class="width100" >
                                        <tr class="graybg">
                                            <th>{{'label.heading.name' | translate}}</th>
                                            <th>{{'label.heading.type' | translate}}</th>
                                            <th>{{'label.heading.amount' | translate}}</th>
                                            <th>{{'label.heading.collectedon' | translate}}</th>
                                        </tr>
                                        <tr ng-repeat="charge in loanaccountinfo.overdueCharges">
                                            <td>{{charge.name}},{{charge.currency.displaySymbol}}</td>
                                            <td>{{charge.chargeCalculationType.value}}</td>
                                            <td>{{charge.amount | number}}</td>
                                            <td>{{charge.chargeTimeType.value}}</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-md-12 paddedtop" ng-hide = "response.uiDisplayConfigurations.loanAccount.isHiddenSection.collateralSection == true">
                                    <label class="control-label"><strong>{{ 'label.heading.collaterals' | translate }}</strong></label>
                                    <select class="form-control width170px"
                                            ng-model="collateralFormData.collateralIdTemplate"
                                            ng-options="collateralTemplate.name for collateralTemplate in collateralOptions" value="{{collateralTemplate.id}}">
                                    </select>&nbsp;&nbsp;
                                    <input class="form-control" ng-model="collateralFormData.collateralValueTemplate" number-format
                                        placeholder="{{'label.input.value' | translate}}" type="text">&nbsp;&nbsp;
                                    <input class="form-control" ng-model="collateralFormData.collateralDescriptionTemplate"
                                        placeholder="{{'label.input.description' | translate}}" type="text">
                                    <a ng-click="addCollateral()">&nbsp;<i class="fa fa-plus "></i></a>
                                </div>
                                <div ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenSection.collateralSection == true">
                                <table class="table" class="width100" ng-show="collaterals.length>0">
                                    <tr class="graybg">
                                        <th>{{'label.heading.type' | translate}}</th>
                                        <th>{{'label.heading.value' | translate}}</th>
                                        <th>{{'label.heading.description' | translate}}</th>
                                        <th>{{'label.heading.actions' | translate}}</th>
                                    </tr>
                                    <tr ng-repeat="collateral in collaterals">
                                        <td><input class="input-sm form-control" ng-model="collateral.name" readonly type="text"></td>
                                        <td><input class="form-control" id="{{collaterals[$index].value}}" ng-model="collateral.value"
                                                type="text"></td>
                                        <td><input class="form-control" id="{{collaterals[$index].description}}" ng-model="collateral.description"
                                                placeholder="{{'label.input.description' | translate}}" type="text"/></td>
                                        <td><a ng-click="deleteCollateral($index)"><i class="fa fa-times "></i></a></td>
                                    </tr>
                                </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>

                <div ng-show="loanaccountinfo">
<span><a ng-click="previewRepayments()" ng-hide="previewRepayment">{{'label.anchor.repaymentinfo' | translate}}<i
class="fa fa-circle-arrow-right"></i></a></span>
<span><a ng-click="previewRepayment=!previewRepayment" ng-show="previewRepayment"><i class="fa fa-circle-arrow-left">{{'label.anchor.backtoloaninfo'
| translate}}</i></a><br><br></span>
                </div>

                        <div>
                            <table class="table width100" ng-show="previewRepayment">
                                <thead>
                                <th colspan="3" scope="col"></th>
                                <th colspan="3" scope="col">{{'label.heading.loanamountandbalance' | translate}}</th>
                                <th colspan="2" scope="col">{{'label.heading.totalcostofloan' | translate}}</th>
                                <th colspan="2" scope="col"></th>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>#</td>
                                    <td>{{'label.heading.date' | translate}}</td>
                                    <td>{{'label.heading.days' | translate}}</td>
                                    <td>{{'label.heading.disbursement' | translate}}</td>
                                    <td>{{'label.heading.principaldue' | translate}}</td>
                                    <td>{{'label.heading.principalbalance' | translate}}</td>
                                    <td>{{'label.heading.interestdue' | translate}}</td>
                                    <td>{{'label.heading.fees' | translate}}</td>
                                    <td>{{'label.heading.penalty' | translate}}</td>
                                    <td>{{'label.heading.due' | translate}}</td>
                                </tr>
                                <tr ng-repeat="period in repaymentscheduleinfo.periods">
                                    <td>{{period.period}}</td>
                                    <td>{{period.dueDate | DateFormat}}</td>
                                    <td>{{period.daysInPeriod}}</td>
                                    <td>{{period.principalDisbursed | number}}</td>
                                    <td>{{period.principalDue| number}}</td>
                                    <td>{{period.principalLoanBalanceOutstanding| number}}</td>
                                    <td>{{period.interestDue| number}}</td>
                                    <td>{{period.feeChargesDue| number}}</td>
                                    <td>{{period.penaltyChargesDue| number}}</td>
                                    <td>{{period.totalDueForPeriod| number}}</td>
                                </tr>
                                <tfoot class="ui-widget-header">
                                <tr>
                                    <td colspan="2">{{'label.heading.total' | translate}}</td>
                                    <td>{{repaymentscheduleinfo.loanTermInDays}}</td>
                                    <td>{{repaymentscheduleinfo.totalPrincipalDisbursed| number}}</td>
                                    <td>{{repaymentscheduleinfo.totalPrincipalExpected| number}}</td>
                                    <td></td>
                                    <td>{{repaymentscheduleinfo.totalInterestCharged| number}}</td>
                                    <td>{{repaymentscheduleinfo.totalFeeChargesCharged| number}}</td>
                                    <td>{{repaymentscheduleinfo.totalPenaltyChargesCharged| number}}</td>
                                    <td>{{repaymentscheduleinfo.totalRepaymentExpected| number}}</td>
                                </tr>
                                </tfoot>
                                </tbody>
                            </table>
                        </div>
                        <div class="center">
                            <button class="btn btn-primary" id="save1" ng-if="datatables" type="submit">
                                {{'label.button.proceed' | translate}}
                            </button>
                            <div ng-if="!datatables">
                                <button class="btn btn-default" id="cancel" ng-click="cancel()" type="reset">{{'label.button.cancel' | translate}}</button>
                                <button class="btn btn-primary" has-permission='CREATE_LOAN' id="save" ng-show="loanaccountinfo" type="submit">{{'label.button.save' |
                                    translate}}
                                </button>
                            </div>
                        </div>
                        </fieldset>
                    </form>
                </div>
                </wz-step>
                <wz-step icon="fa fa-circle-o" id="dynamicSteps" ng-if="datatables" ng-repeat="datatable in datatables"  title="{{datatable.registeredTableName}}">
                    <form class="form-horizontal well" ng-submit="submit()">
                        <api-validate></api-validate>
                        <fieldset>
                            <h3><strong>{{datatable.registeredTableName}}</strong></h3>
                            <hr/>
                            <div class="form-group" ng-repeat="columnHeader in datatable.columnHeaderData">
                                <label class="control-label col-sm-3">{{ columnHeader.columnName | prettifyDataTableColumn }}
                                    <span class="required" ng-show="!columnHeader.isColumnNullable">*</span>
                                </label>

                                <div class="col-sm-3">
                                    <input class="form-control" ng-model="formData.datatables[datatables.indexOf(datatable)].data[columnHeader.columnName]"
                                            ng-show="fieldType(columnHeader.columnDisplayType) == 'TEXT'" type="text"/>
                                    <input class="form-control" datepicker-pop="dd MMMM yyyy"
                                            is-open="opened{{$index}}" ng-model="formDat.datatables[datatables.indexOf(datatable)].data[columnHeader.columnName]"
                                            ng-show="fieldType(columnHeader.columnDisplayType) == 'DATE'" type="text"/>
                                    <div class="form-inline" ng-show="fieldType(columnHeader.columnDisplayType) == 'DATETIME'">
                                        <div class="form-group">
                                            <input class="form-control" datepicker-pop="dd MMMM yyyy"
                                                    is-open="opened{{$index}}"
                                                    ng-model="formDat.datatables[datatables.indexOf(datatable)].data[columnHeader.columnName].date" type="text"/>
                                        </div>
                                        <div class="form-group">
                                            <input class="form-control" ng-model="formDat.datatables[datatables.indexOf(datatable)].data[columnHeader.columnName].time"
                                                    placeholder="HH:MM:SS" type="time"/>
                                        </div>
                                    </div>
                                    <div ng-show="fieldType(columnHeader.columnDisplayType) == 'BOOLEAN'">
                                        <label class="radio-inline">
                                            <input ng-model="formData.datatables[datatables.indexOf(datatable)].data[columnHeader.columnName]" type="radio"
                                                    value="true"/>
                                            {{'label.input.true' | translate}}
                                        </label>
                                        <label class="radio-inline">
                                            <input ng-model="formData.datatables[datatables.indexOf(datatable)].data[columnHeader.columnName]" type="radio"
                                                    value="false"/>
                                            {{'label.input.false' | translate}}
                                        </label>
                                    </div>
                                    <span data-ng-switch on="columnHeader.columnDisplayType">
                                        <select class="form-control"
                                                data-ng-switch-when="CODELOOKUP"
                                                ng-model="formData.datatables[datatables.indexOf(datatable)].data[columnHeader.columnName]"
                                                ng-options="columnValue.id as columnValue.value for columnValue in columnHeader.columnValues"
                                                ng-show="fieldType(columnHeader.columnDisplayType) == 'SELECT'" value="{{columnValue.id}}">
                                            <option value="">{{'label.selectone' | translate}}</option>
                                        </select>
                                        <select class="form-control"
                                                data-ng-switch-when="CODEVALUE"
                                                ng-model="formData.datatables[datatables.indexOf(datatable)].data[columnHeader.columnName]"
                                                ng-options="columnValue.value as columnValue.value for columnValue in columnHeader.columnValues"
                                                ng-show="fieldType(columnHeader.columnDisplayType) == 'SELECT'" value="{{columnValue.id}}">
                                            <option value="">{{'label.selectone' | translate}}</option>
                                        </select>
                                    </span>
                                </div>
                            </div>
                            <div class="pull-right" ng-if="!$last">
                                <button class="btn btn-primary" id="save4" type="submit">
                                    {{'label.button.proceed' | translate}}
                                </button>
                            </div>
                            <div class="col-md-offset-5" ng-if="$last">
                                <button class="btn btn-default" id="cancel3" ng-click="cancel()" type="reset">{{'label.button.cancel' | translate}}</button>
                                <button class="btn btn-primary" has-permission='CREATE_LOAN' id="save3" ng-show="loanaccountinfo" type="submit">{{'label.button.save' |
                                    translate}}
                                </button>
                            </div>
                        </fieldset>
                    </form>
                </wz-step>
                    </div>
                </wizard>
            </div>
        </div>
    </div>
</div>
